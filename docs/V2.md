# Proposal for a V2

## Should feel more like `net/url.URL`

  * [x] Make `uri.URI` a concrete type
  * In theory, this is a breaking change, but has most likely little impact on actual usage
    * [x] Checked that this wouldn't break fyne-io/fyne

  * [x] The interface abstraction comes at a (small) performance cost, and there is no palatable benefit from it
  * More methods from `URL` should be supported by `URI`, e.g. :
    * [x] `UnmarshalText()`,
    * [x] `MarshalBinary()`,
    * [x] `IsAbs()`
    * `Redacted()`... see [todo.go](../todo.go) 
  * Similarly, support more methods from `net/url.UserInfo` in the `Authority` type.
  * However:
    * [x] Let's keep the `Authority` part, as it better sticks to how the object is structured according to the RFC.
    * [x] Let's keep the fluent `Builder` component. I don't think that exposing fields like in `URL` is a good choice.
    * [x] Remove `Authority` and `Builder` interfaces.

## Canonicalization 
  * Extra features only: no breaking change

  * [x] `URI.String()` currently just prints out the URL. We may leave it like this.
  * `Normalize()` and `Normalized()` methods should canonicalize the URI (case, simplified path, etc),
    like the `purell` package does.
    Notice that `purell` seems to be no longer maintained: pulling a dependency is probably not appropriate.

## Strictness/compliance options
  * Should not be breaking, but enhanced strictness could break a few tests in consuming packages.

  * [x] We should add options like `type Option func(*options)` to provide more flexibility when parsing & validating
  * In particular:
    * we should be able to abide strictly by the historical standard (no unicode, **puny code in host names should be validated**)
    (for punycode, let's take some inspiration from `https://github.com/jonasbn/punycode` and `https://pkg.go.dev/golang.org/x/net/idna#Profile`)
    * callers should be able to opt in for IRI vs strict (historical) URI - e.g. only ASCII - rather than the current mixed 
    implementation (yet again, that was a pragmatic... still pondering if putting more nitpicking is appropriate).
    * [x] callers should be able to configure DNS schemes from options rather than overriding a package-level variable
    * [x] default options could be set at the package level to save on systematic option resolution at parsing time
    (alternatively, expose a `Parser` type to wrap options once for a series of subsequent calls to `Parse()`/`Validate()`)
    * support canonicalization options with flags such as those defined in `https://pkg.go.dev/golang.org/x/net/idna`
    * add windows-friendly tolerance option for windows file paths (`Normalize()` would produce a RFC-compliant form)

  * Standard compliance improvements
    * Improve IRI support: current support for IRI is at best loose, albeit pragmatic
      (currently, a valid ALPHA token is a unicode letter codepoint, only ASCII digits are supported)

## Performance 
  * [x] Introduce `Make` methods to return a struct rather than a pointer: this saves an allocation
    for most use cases in which it is not necessary to get a pointer receiver.
